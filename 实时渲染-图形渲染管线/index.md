# 图形渲染管线


## ***引言***

*本博客介绍了实时图形学中的核心组件，它被称为“图形渲染管线（graphics rendering pipeline）”，也被简称为“管线”。*

*渲染管线的核心功能就是利用给定的虚拟相机、三维物体、光源等信息，来生成或者渲染（render）一张二维图像。因此， 渲染管线是实时渲染中的底层工具*

## ***渲染管线的架构***

*一种粗略的划分方法是将渲染管线分为四个阶段——应用阶段（application）、几何处理阶段（geometry processing）、光栅化阶段（rasterization）和像素处理阶段（pixel processing）*

![渲染管线的架构](https://raw.githubusercontent.com/vlicecream/cloudImage/main/image-20250909232828388.png)

*渲染速度可以用每秒帧数（FPS）来进行表示，即每秒显示的帧数；也可以用赫兹 （Hz）来进行表示，这个单位代表了 ，即更新的频率。*

1. *应用阶段（application）是由应用程序进行驱动的，它在软件中进行实现，运行在通用 CPU 上。这些 CPU 一般都具有多个核心，可以并行处理多个线程 （thread）的任务，这使得 CPU 可以高效执行由应用阶段所负责的各种任务，一般 CPU 会负责碰撞检测，全局加速算法，动画，物理模拟等任务，具体会执行哪些任 务取决于应用程序的类型。*
2. *下一个主要阶段是几何处理阶段（geometry processing），它负责处理变换（transform），投影（projection）以及其他所有和 几何处理相关的任务。这个阶段需要计算哪些物体会被绘制，应该如何进行绘制，以 及应当在哪里绘制等问题。几何阶段通常运行在硬件处理单元（GPU）上，它包含一 系列的可编程单元和固定操作硬件。*
3. *光栅化阶段（rasterization）通常会将构成一个 三角形的三个顶点作为输入，找到所有位于三角形内部的像素，并将其转发到下一个 阶段中。*
4. *最后一个阶段是像素处理阶段（pixel processing），对于每个像素而言， 都会执行一个程序来决定它的颜色；并执行深度测试，来判断这个像素是否可见；这 里还可以执行一些逐像素的操作，例如将新计算的颜色和之前的颜色进行混合。*

*光栅化阶段和像素处理阶段同样完全运行在 GPU 上*

## ***应用阶段***

*由于应用阶段通常都运行在 CPU 上， 因此开发者可以完全控制在应用阶段发生的事情*

*有一些应用阶段中的任务也可以让 GPU 来进行执行，即通过使用一个叫 做计算着色器（compute shader）的独立模式，该模式会将 GPU 视为一个高度并行 的通用处理器，而忽略其专门用于图形渲染的特殊功能*

*在应用阶段的最后，需要进行渲染的几何物体会被输入到几何处理阶段中，这些几何 物体被称作为渲染图元（rendering primitive），即点、线和三角形。*

*碰撞检测（collision detection）通常会在这个阶段中实现。当检测到两个物体之间 的碰撞之后，会产生相应的响应，并返回给碰撞物体，同时也返回给力反馈设备（如 果有的话）。*

*应用阶段同样也是处理其他来源输入的地方，例如键盘、鼠标或者头戴 式显示器等，会根据不同的输入，从而采取不同的操作。此外，一些加速算法例如特 殊的剔除算法等，以及渲染管线剩余部分无法处理的一切问题，都会在 应用阶段中完成。*

## ***几何处理阶段***

*运行在 GPU 上的几何处理阶段会负责大部分的逐三角形（per-triangle）和逐顶点 （per-vertex）操作。将几何处理阶段再细分下去，可以划分为以下几个功能性阶 段：顶点着色（vertex shading）、投影（projection）、裁剪（clipping）和屏幕映 射（screen mapping），如图 2.3 所示.*

![几何处理阶段](https://raw.githubusercontent.com/vlicecream/cloudImage/main/image-20250909234033002.png)

### ***顶点着色***

*顶点着色（vertex shading）的任务主要有两个*

1. *一个是计算顶点的位置*
2. *另一个是 计算那些开发人员想要作为顶点数据进行输出的任何参数，例如法线（normal）和纹理坐标（texture coordinate）等*

*顶点着色器如今是一个更加通用的单元，它负责计算并设置与每个顶点都相关的数据。例如顶点着色器可以用来计算物体的动画。*

